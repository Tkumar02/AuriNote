<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <form [formGroup]="editDetailsForm" (ngSubmit)="onSubmit()" class="settings-form">
        
        <div class="form-card shadow-sm mb-4">
          <div class="card-header-purple">
            <h5 class="mb-0"><i class="fa fa-user-circle mr-2"></i>Personal Profile</h5>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label class="label-custom">Full Name</label>
              <input [value]="profileExists ? profile.name : ''" type="text" class="form-control-custom" formControlName="name" placeholder="Enter your name">
            </div>
            <div class="form-group mb-0">
              <label class="label-custom">Home Address</label>
              <input [value]="profileExists ? profile.address : ''" type="text" class="form-control-custom" formControlName="address" placeholder="123 Main St, London">
            </div>
          </div>
        </div>

        <div class="form-card shadow-sm mb-4">
          <div class="card-header-purple d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fa fa-users mr-2"></i>Clients</h5>
            <button type="button" class="btn btn-sm btn-light text-purple font-weight-bold" (click)="addClient()">+ Add Client</button>
          </div>
          <div class="card-body">
            <div *ngIf="clients.length === 0" class="text-center py-3 text-muted italic">
              <small>No clients added yet.</small>
            </div>
            <div formArrayName="clients">
              <div *ngFor="let client of clients.controls; let i=index" [formGroupName]="i" class="dynamic-row mb-3 p-3 rounded">
                <div class="row">
                  <div class="col-md-5">
                    <input type="text" class="form-control-custom" formControlName="clientName" placeholder="Client Name">
                  </div>
                  <div class="col-md-5">
                    <input type="text" class="form-control-custom" formControlName="clientAddress" placeholder="Address">
                  </div>
                  <div class="col-md-2 text-right">
                    <button type="button" class="btn-remove" (click)="removeClient(i)">×</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="form-card shadow-sm mb-4">
          <div class="card-header-purple d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fa fa-briefcase mr-2"></i>Your Companies</h5>
            <button type="button" class="btn btn-sm btn-light text-purple font-weight-bold" (click)="addBusiness()">+ Add Company</button>
          </div>
          <div class="card-body" formArrayName="businesses">
            <div *ngIf="businesses.length === 0" class="text-center py-3 text-muted">
                <small>No company details available.</small>
            </div>
            <div *ngFor="let business of businesses.controls; let i=index" [formGroupName]="i" class="dynamic-row mb-3 p-3">
              <div class="row mb-2">
<div class="col-md-6">
  <div class="d-flex justify-content-between align-items-center mb-1">
    <label class="small-label mb-0">Company Name</label>
    <span *ngIf="isSynced(i)" class="badge badge-success px-2 py-1" style="font-size: 8px; border-radius: 4px;">
      <i class="fa fa-link mr-1"></i>Synced
    </span>
  </div>
  
  <input type="text" 
         class="form-control-custom" 
         formControlName="businessName" 
         [readonly]="isSynced(i)"
         [style.backgroundColor]="isSynced(i) ? '#f8f9fa' : 'white'">
  
  <input type="hidden" formControlName="companyId">
</div>
                <div class="col-md-6">
                  <label class="small-label">Company Type</label>
                  <select class="form-control-custom" 
                          formControlName="businessType"
                          [attr.disabled]="isSynced(i) ? true : null"> 
                          <option value="" disabled>Select type...</option>
                    <option *ngFor="let type of businessTypes" [value]="type">{{ type }}</option>
                  </select>
                </div>
              </div>
              <div class="row">
                <div class="col-md-10">
                  <label class="small-label">Company Address</label>
                  <input type="text" 
                        class="form-control-custom" 
                        formControlName="businessAddress"
                        [readonly]="isSynced(i)"
                        [style.backgroundColor]="isSynced(i) ? '#f8f9fa' : 'white'">                
                </div>
                <div class="col-md-2 pt-4">
                  <button type="button" class="btn btn-outline-danger btn-block border-0" (click)="removeBusiness(i)">Remove</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="form-card shadow-sm mb-5">
          <div class="card-header-purple d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fa fa-university mr-2"></i>Bank Accounts</h5>
            <button type="button" class="btn btn-sm btn-light text-purple font-weight-bold" (click)="addBank()">+ Add Bank</button>
          </div>
          <div class="card-body" formArrayName="bankDetails">
            <div *ngFor="let bank of bankDetails.controls; let i = index" [formGroupName]="i" class="bank-row mb-4 p-3 shadow-xs">
              <div class="row">
                <div class="col-md-6 mb-2"><input type="text" class="form-control-custom" formControlName="bankNickName" placeholder="Bank Nickname (e.g. Personal)"></div>
                <div class="col-md-6 mb-2"><input type="text" class="form-control-custom" formControlName="bankName" placeholder="Bank Name"></div>
                <div class="col-md-5"><input type="text" class="form-control-custom" formControlName="accountNumber" placeholder="Account Number"></div>
                <div class="col-md-5"><input type="text" class="form-control-custom" formControlName="sortCode" placeholder="Sort Code"></div>
                <div class="col-md-2"><button type="button" class="btn-remove" (click)="removeBank(i)">×</button></div>
              </div>
            </div>
          </div>
        </div>

        <div class="text-center pb-5">
          <button class="btn btn-purple-lg px-5 shadow" type="submit">Save All Changes</button>
        </div>

      </form>
    </div>
  </div>
</div>